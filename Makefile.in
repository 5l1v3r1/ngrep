#
# $Id$
#
# Copyright (c) 2005  Jordan Ritter <jpr5@darkridge.com>
#
# Please refer to the LICENSE file for more information.

CC=@CC@

CFLAGS=@CFLAGS@ -D@OS@ @DEFS@ @EXTRA_DEFINES@ 
INCLUDES=-I@srcdir@ @PCAP_INCLUDE@ @EXTRA_INCLUDES@

LDFLAGS=@LDFLAGS@ @PCAP_LINK@
LIBS=-lpcap @EXTRA_LIBS@ 

STRIPFLAG=@STRIPFLAG@

SRC=ngrep.c 
OBJS=ngrep.o 
TARGET=ngrep
MANPAGE=ngrep.8

prefix      = @prefix@
exec_prefix = @exec_prefix@

bindir      = $(prefix)/bin
datadir     = $(prefix)/share
mandir      = $(datadir)/man

BINDIR_INSTALL = $(prefix)/bin
MANDIR_INSTALL = $(mandir)/man8

INSTALL = ./install-sh

REGEX_TARGET=@REGEX_TARGET@
REGEX_OBJS=@REGEX_OBJS@


all: $(TARGET) 

$(TARGET): $(REGEX_TARGET) $(OBJS) 
	$(CC) $(CFLAGS) $(LDFLAGS) $(STRIPFLAG) -o $(TARGET) $(OBJS) $(REGEX_OBJS) $(LIBS) 

debug: $(OBJS)
	$(CC) $(CFLAGS) $(LDFLAGS) -g -o $(TARGET) $(OBJS) $(REGEX_OBJS) $(LIBS) 

static: $(OBJS)
	$(CC) $(CFLAGS) $(LDFLAGS) $(STRIPFLAG) -o $(TARGET).static -static $(OBJS) $(REGEX_OBJS) $(LIBS) 

install: $(TARGET)
	$(INSTALL) -c -m 0755 $(TARGET)  $(DESTDIR)/$(BINDIR_INSTALL)/$(TARGET)
	$(INSTALL) -c -m 0644 $(MANPAGE) $(DESTDIR)/$(MANDIR_INSTALL)/$(MANPAGE)

pcre: 
	@cd pcre-5.0   && make $(REGEX_OBJS) && cp -f $(REGEX_OBJS) .. 

regex:
	@cd regex-0.12 && make $(REGEX_OBJS) && cp -f $(REGEX_OBJS) .. 

$(OBJS): Makefile

.c.o:	
	$(CC) $(CFLAGS) $(INCLUDES) -g -c $<

clean:
	rm -f *~ $(OBJS) $(REGEX_OBJS) $(TARGET) 

distclean: clean clean-$(REGEX_TARGET)
	rm -f config.status config.cache config.log config.h Makefile 

clean-pcre:
	cd pcre-5.0   && rm -f RunTest dftables libpcre.pc && test -f ./Makefile && make distclean 

clean-regex:
	cd regex-0.12 && rm -f Makefile doc/Makefile test/Makefile config.cache config.log config.status

ngrep.o: ngrep.c ngrep.h
