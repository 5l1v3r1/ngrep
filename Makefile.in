#
# $Id$
#
# Copyright (c) 2001  Jordan Ritter <jpr5@darkridge.com>
#
# Please refer to the COPYRIGHT file for more information.


CC=@CC@

INCLUDES=-I@srcdir@ @PCAP_INCLUDE@
CFLAGS=@CFLAGS@ @DEFS@
LDFLAGS=@LDFLAGS@ @PCAP_LINK@
LIBS=-lpcap @EXTRA_LIBS@

SRC=ngrep.c 
OBJS=ngrep.o 
TARGET=ngrep
MANPAGE=ngrep.8

INSTALL=./install-sh
BINDEST=@prefix@/bin
MANDEST=@prefix@/man/man8

REGEX_TARGET=@REGEX_TARGET@
REGEX_OBJS=@REGEX_OBJS@


all: $(TARGET) 

$(TARGET): $(REGEX_TARGET) $(OBJS) 
	$(CC) $(CFLAGS) $(LDFLAGS) -s -o $(TARGET) $(OBJS) $(REGEX_OBJS) $(LIBS) 

debug: $(OBJS)
	$(CC) $(CFLAGS) $(LDFLAGS) -g -o $(TARGET) $(OBJS) $(REGEX_OBJS) $(LIBS) 

static: $(OBJS)
	$(CC) $(CFLAGS) $(LDFLAGS) -s -o $(TARGET).static -static $(OBJS) $(REGEX_OBJS) $(LIBS) 

install: $(TARGET)
	$(INSTALL) -c -m 0755 $(TARGET) $(BINDEST)
	$(INSTALL) -c -m 0644 $(MANPAGE) $(MANDEST)

pcre: 
	@( cd pcre-3.4; make $(REGEX_OBJS) && cp -f $(REGEX_OBJS) .. )

regex: 
	@( cd regex-0.12; make $(REGEX_OBJS) && cp -f $(REGEX_OBJS) .. )

.c.o:	
	$(CC) $(CFLAGS) $(INCLUDES) -g -c $<

clean:
	rm -f *~ $(OBJS) $(REGEX_OBJS) $(TARGET) 

distclean: clean clean-$(REGEX_TARGET)
	rm -f config.status config.cache config.log Makefile .depends

clean-pcre:
	( cd pcre-3.4; if [ -f ./Makefile ]; then make distclean; fi )

clean-regex:
	( cd regex-0.12; if [ -f ./Makefile ]; then make distclean; fi )

ngrep.o: ngrep.c ngrep.h
