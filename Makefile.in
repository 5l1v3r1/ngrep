#
# $Id$
#
# Copyright (c) 2004  Jordan Ritter <jpr5@darkridge.com>
#
# Please refer to the LICENSE file for more information.

CC=@CC@

CFLAGS=@CFLAGS@ -D@OS@ @DEFS@ @EXTRA_DEFINES@ 
INCLUDES=-I@srcdir@ @PCAP_INCLUDE@ @EXTRA_INCLUDES@

LDFLAGS=@LDFLAGS@ @PCAP_LINK@
LIBS=-lpcap @EXTRA_LIBS@ 

STRIPFLAG=@STRIPFLAG@

SRC=ngrep.c 
OBJS=ngrep.o 
TARGET=ngrep
MANPAGE=ngrep.8

prefix      = @prefix@
exec_prefix = @exec_prefix@
BINDIR      = @bindir@
MANDIR      = @mandir@/man8

INSTALL = ./install-sh

REGEX_TARGET=@REGEX_TARGET@
REGEX_OBJS=@REGEX_OBJS@


all: $(TARGET) 

$(TARGET): $(REGEX_TARGET) $(OBJS) 
	$(CC) $(CFLAGS) $(LDFLAGS) $(STRIPFLAG) -o $(TARGET) $(OBJS) $(REGEX_OBJS) $(LIBS) 

debug: $(OBJS)
	$(CC) $(CFLAGS) $(LDFLAGS) -g -o $(TARGET) $(OBJS) $(REGEX_OBJS) $(LIBS) 

static: $(OBJS)
	$(CC) $(CFLAGS) $(LDFLAGS) $(STRIPFLAG) -o $(TARGET).static -static $(OBJS) $(REGEX_OBJS) $(LIBS) 

install: $(TARGET)
	$(INSTALL) -c -m 0755 $(TARGET)  $(DESTDIR)/$(BINDIR)/$(TARGET)
	$(INSTALL) -c -m 0644 $(MANPAGE) $(DESTDIR)/$(MANDIR)/$(MANPAGE)

pcre: 
	@( cd pcre-3.4; make $(REGEX_OBJS) && cp -f $(REGEX_OBJS) .. )

regex: 
	@( cd regex-0.12; make $(REGEX_OBJS) && cp -f $(REGEX_OBJS) .. )

$(OBJS): Makefile

.c.o:	
	$(CC) $(CFLAGS) $(INCLUDES) -g -c $<

clean:
	rm -f *~ $(OBJS) $(REGEX_OBJS) $(TARGET) 

distclean: clean clean-$(REGEX_TARGET)
	rm -f config.status config.cache config.log config.h Makefile .depends

clean-pcre:
	( cd pcre-3.4; if [ -f ./Makefile ]; then make distclean; fi )

clean-regex:
	( cd regex-0.12; if [ -f ./Makefile ]; then make distclean; fi )

ngrep.o: ngrep.c ngrep.h
